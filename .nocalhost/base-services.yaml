- name: backend
  serviceType: deployment
  dependLabelSelector: 
    jobs:
      - "dep-job"
  containers:
    - name: backend
      install: 
        portForward:   
          - 38080:80
          - 29080:19080
      dev:
        gitUrl: https://github.com/lipeiru0329/bookinfo-productpage.git
        image: sgccr.ccs.tencentyun.com/intl-backend/intlnh:v3
        shell: bash
        workDir: /data/home/user00
        sync: 
          type: sendreceive
          filePattern: 
            - ./
          ignoreFilePattern:
            - ".git"
            - ".github"
            - ".idea"
        portForward:
        - 38080:80
        - 29080:19080
- name: productpage
  serviceType: deployment
  dependLabelSelector: 
    jobs:
      - "dep-job"
  containers:
    - name: productpage
      install: 
        portForward:   
          - 39080:9080
          - 29080:19080
      dev:
        gitUrl: https://github.com/lipeiru0329/bookinfo-productpage.git
        image: tudouaidigua/productage:0.1
        shell: bash
        workDir: /home/nocalhost-dev
        sync: 
          type: sendreceive
          filePattern: 
            - ./
          ignoreFilePattern:
            - ".git"
            - ".github"
            - ".idea"
        portForward:
        - 39080:9080
        - 29080:19080
- name: details
  serviceType: deployment
  containers:
    - dev:
        gitUrl: https://github.com/lipeiru0329/bookinfo-details.git
        image: codingcorp-docker.pkg.coding.net/nocalhost/dev-images/ruby:2.7.1-slim
        shell: bash
        workDir: /home/nocalhost-dev
        sync: 
          type: send
          filePattern: 
            - ./
          ignoreFilePattern:
            - ".git"
            - ".github"
        env: 
        - name: DEBUG
          value: "true"
- name: ratings
  serviceType: deployment
  dependLabelSelector: 
    pods: 
      - "productpage"
      - "app.kubernetes.io/name=productpage"
    jobs:
      - "dep-job"
  containers:
    - dev:
        gitUrl: https://github.com/lipeiru0329/bookinfo-ratings.git
        image: codingcorp-docker.pkg.coding.net/nocalhost/dev-images/node:12.18.1-slim
        shell: bash
        workDir: /home/nocalhost-dev
        command:
          build: []
          run:
            - node
            - ratings.js
          debug:
            - npm
            - install
            - "&&"
            - node
            - --inspect-brk
            - ratings.js
          hotReloadRun: []
          hotReloadDebug: []
        debug:
          remoteDebugPort: 9229
        sync: 
          type: send
          filePattern: 
            - ./
          ignoreFilePattern:
            - ".git"
            - ".github"
            - "node_modules"
        env: 
        - name: DEBUG
          value: "true"
- name: reviews
  serviceType: deployment
  dependLabelSelector: 
    pods: 
      - "productpage"
  containers:
    - dev:
        gitUrl: https://github.com/lipeiru0329/bookinfo-reviews.git
        image: codingcorp-docker.pkg.coding.net/nocalhost/dev-images/java:latest
        shell: bash
        workDir: /home/nocalhost-dev
        command:
          build: [ "./gradlew", "build" ]
          run: [ "./gradlew", "bootRun" ]
          debug: [ "./gradlew", "bootRun", "--debug-jvm" ]
        debug:
          remoteDebugPort: 5005
        sync: 
          type: send
          filePattern: 
            - ./
          ignoreFilePattern:
            - ".git"
            - ".github"
            - ".gradle"
            - "build"